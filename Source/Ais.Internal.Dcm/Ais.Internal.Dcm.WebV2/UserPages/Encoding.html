<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Encoding type management</title>
    <script src="../Scripts/script-loader.js"></script>

    <script>
        var apiUrl = '../api/admin/GetEncodingTypes?mediaServiceName=random';
        var editMsg = "Edit Encoding Type";
        var createMsg = 'Add Encoding Type';
        var confirmDeleteMsg = 'Are you sure you want to delete this entry?';
        $(document).ready(function () {
            $("li#encodingLink").addClass('active');
            checkForUserAdmin();
            bindSignOut();
            $("#addEncoding").click(function () {
                $(".alert").addClass("invisible");
                if (ValidateData()) {
                    $.ajax({
                        type: "POST",
                        url: '../api/admin/CreateEncodingType',
                        data: { TechnicalName: htmlEncode($(inputTechnicalName).val()), FriendlyName: htmlEncode($(inputFriendlyName).val()) },
                        success: function () { alert('successful'); },
                        dataType: "application/json"
                    });
                    ResetWindow();
                    $("#myModal").modal('hide');
                    setTimeout(LoadEncodingTypes, 1000);
                    ResetWindow();
                }
                else {
                    $(".alert").removeClass("invisible");
                }
            });
            LoadEncodingTypes();
        });

        function DeleteEncodingType(technicalName) {
            if (confirm(confirmDeleteMsg)) {
                $.ajax({
                    type: "DELETE",
                    url: '../api/admin/DeleteEncodingType',
                    data: { TechnicalName: htmlEncode(technicalName) },
                    success: function () { alert('successful'); },
                    dataType: "application/json"
                });

                LoadEncodingTypes();
            }
        }

        function EditEncodingType(friendlyName, technicalName) {
            $(inputFriendlyName).val(friendlyName);
            $(inputTechnicalName).val(technicalName);
            $(inputTechnicalName).attr("readonly", "readonly");
            $(myModalLabel).text(editMsg);
            $(addEncoding).text("Edit");
            $("#myModal").modal('show');
        }
        function ValidateData() {

            if ($(inputFriendlyName).val() != '' && $(inputTechnicalName).val() != '') {
                return true;
            }
            return false;
        }

       
        function LoadEncodingTypes() {
            $("#listencodingType").html('');
            var head = $('<tr>');
            $('<th>Friendly Name</th>').appendTo($(head));
            $('<th>Technical Name</th>').appendTo($(head));
            $('<th>Action </th>').appendTo($(head));
            $(head).appendTo('#listencodingType');

            $.getJSON(apiUrl)
          .done(function (data) {
              // On success, 'data' contains a list of products.
              $.each(data, function (key, item) {
                  // Add a list item for the product.
                  var friendlyName = htmlDecode(item.FriendlyName);
                  var technicalName = htmlDecode(item.TechnicalName);
                  var tr = $('<tr>');
                  $('<td>', { text: item.FriendlyName }).appendTo($(tr));
                  $('<td>', { text: item.TechnicalName }).appendTo($(tr));
                  $("<button  class=\"btn btn-info\" style=\"margin-left:10px;margin-top:5px;\" onclick=\"EditEncodingType('" + friendlyName + "','" + technicalName + "')\"  >Edit</button>").appendTo($(tr));
                  $("<button  class=\"btn btn-danger\" style=\"margin-left:10px;margin-top:5px;\" onclick=\"DeleteEncodingType('" + technicalName + "')\"  >Delete</button>").appendTo($(tr));
                  $(tr).appendTo('#listencodingType');
              });
          }).error(function (request, status, error) {
              alert(request.responseText);
          });
        }

        function ResetWindow() {

            $(inputFriendlyName).val('');
            $(inputTechnicalName).val('');
            $(myModalLabel).text(createMsg);
            $(addEncoding).text("Add");
            $('#myModal').modal('hide');
            $(".alert").addClass("invisible");
            $(inputTechnicalName).removeAttr("readonly", "readonly");

        }

    </script>
</head>
<body>

    <script src="../Scripts/header.js"></script>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span2">
            </div>
            <div class="span10">
                <h4>Available Encoding Types</h4>
                <table id="listencodingType" class="table table-striped table-bordered table-hover">
                    <thead>
                    </thead>
                </table>
                <div class="well well-small">
                    <a href="#myModal" role="button" class="btn btn-primary" data-toggle="modal">Register New Encoding Type</a>
                </div>

                <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" onclick="ResetWindow();" aria-hidden="true">×</button>
                        <h3 id="myModalLabel">Add Encoding Type</h3>
                    </div>
                    <div class="modal-body">
                        <div class="form-horizontal">

                            <div class="control-group">
                                <label class="control-label" for="inputFriendlyName">Friendly Name</label>
                                <div class="controls">
                                    <input type="text" id="inputFriendlyName" placeholder="User friendly name" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label" for="inputTechnicalName">Technical Name</label>
                                <div class="controls">
                                    <input type="text" id="inputTechnicalName" placeholder="Technical Name" />
                                </div>
                            </div>

                            <div class="control-group">
                                <div class="controls">

                                    <button type="button" id="addEncoding" class="btn btn-primary">Add</button>
                                    <button type="button" class="btn btn-danger" onclick="ResetWindow();">Cancel</button>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-error invisible">
                            <button type="button" class="close" onclick="$('.alert').addClass('invisible');">&times;</button>
                            <strong>Error!</strong> All fields are required.
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <script src="../Scripts/footer.js"></script>
</body>
</html>
